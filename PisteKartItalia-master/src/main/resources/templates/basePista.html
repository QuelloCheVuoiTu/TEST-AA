<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${track.nome} + ' - Racing Tracks'">Pista - Racing Tracks</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Font Awesome per le icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin:0;
            padding:0;
            box-sizing:border-box;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: rgba(255, 255, 255, 0.85);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: default;
        }
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: url('/sfondo.jpg') center center/cover no-repeat;
            opacity: 0.25;
            z-index: 0;
            pointer-events: none;
        }
        body {
            position: relative;
            z-index: 1;
        }

        /* Navbar minimal con effetto vetro */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px 5%;
            border-bottom: 1px solid rgba(255, 60, 60, 0.2);
            width: 100%;
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.4s ease;
        }
        .navbar:hover {
            background: rgba(30, 30, 30, 0.8);
            border-bottom: 1px solid rgba(255, 60, 60, 0.4);
        }
        .navbar .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.6rem;
            font-weight: 600;
            color: #fff;
            text-align: center;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 60, 60, 0.5);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .navbar .logo:hover {
            transform: scale(1.05);
            text-shadow: 0 0 15px rgba(255, 60, 60, 0.8);
        }
        .navbar ul {
            display: flex;
            list-style: none;
            gap: 30px;
        }
        .navbar ul li a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-weight: 400;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            padding: 8px 0;
            position: relative;
        }
        .navbar ul li a:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 1px;
            background: #ff3c3c;
            transition: width 0.3s ease;
        }
        .navbar ul li a:hover {
            color: #fff;
        }
        .navbar ul li a:hover:after {
            width: 100%;
        }

        /* Sezione Powered by Vroom */
        .powered-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(255, 60, 60, 0.1);
        }
        .powered-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.5rem;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 2px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .vroom-logo {
            width: 120px;
            height: 40px;
            background: linear-gradient(45deg, #ff3c3c, #ff7b7b);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 0 15px rgba(255, 60, 60, 0.4);
            transition: all 0.3s ease;
        }
        .vroom-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 60, 60, 0.6);
        }

        /* Hero section con video YouTube - CORRETTO */
        .track-hero {
            position: relative;
            width: 100%;
            height: 70vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }

        .video-background iframe {
            width: 60%;
            height: 95%;
            object-fit: cover;
            opacity: 1; /* Video sempre completamente opaco */
            transition: opacity 0.5s ease;
        }
        .video-background.full-opacity iframe {
            opacity: 1; /* Video leggermente più scuro quando scompare il titolo */
        }

        .track-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 4rem;
            text-align: center;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 60, 60, 0.7);
            z-index: 3; /* Aumentato per essere sopra il video */
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 60, 60, 0.2);
            transition: all 0.4s ease;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 1;
            transition: opacity 0.8s ease, transform 0.4s ease;
        }
        .track-name.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .track-name.smaller {
            font-size: 2.5rem;
            top: 20%;
            transform: translate(-50%, 0);
            padding: 15px;
        }
        .track-name:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 0 30px rgba(255, 60, 60, 0.4);
            border: 1px solid rgba(255, 60, 60, 0.4);
        }
        .track-name.smaller:hover {
            transform: translate(-50%, 0) scale(1.05);
        }

        /* Controlli video */
        .video-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 4; /* Aumentato per essere sopra tutto */
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }
        .track-hero:hover .video-controls {
            opacity: 1;
        }
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .control-btn:hover {
            background: rgba(255, 60, 60, 0.6);
            transform: scale(1.1);
        }

        /* Sezione Calendario */
        .calendar-section {
            padding: 40px 5%;
            width: 100%;
            max-width: 1200px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .calendar-nav-btn {
            background: rgba(255, 60, 60, 0.2);
            border: 1px solid rgba(255, 60, 60, 0.3);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .calendar-nav-btn:hover {
            background: rgba(255, 60, 60, 0.3);
            transform: scale(1.1);
        }
        .calendar-month-year {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: white;
            text-align: center;
        }
        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 60, 60, 0.4);
        }
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        .weekday {
            text-align: center;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            padding: 10px;
        }
        .calendar-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 40px;
        }
        .calendar-day {
            aspect-ratio: 1/1;
            background: rgba(25, 25, 25, 0.5);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .calendar-day.empty {
            background: rgba(15, 15, 15, 0.3);
            cursor: default;
        }
        .calendar-day:hover:not(.empty) {
            transform: scale(1.8);
            box-shadow: 0 0 20px rgba(255, 60, 60, 0.4);
            border: 1px solid rgba(255, 60, 60, 0.3);
            z-index: 10;
        }
        .day-number {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
            transition: all 0.3s ease;
        }
        .day-events {
            opacity: 0;
            height: 0;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            padding: 0 5px;
        }
        .calendar-day:hover:not(.empty) .day-number {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        .calendar-day:hover:not(.empty) .day-events {
            opacity: 1;
            height: auto;
        }
        .has-event:after {
            content: '';
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background: #ff3c3c;
            border-radius: 50%;
        }

        /* Card evento espansa (simile a homepage) */
        .event-card-expanded {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            width: 300px;
            background: rgba(25, 25, 25, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 20;
            transition: all 0.4s ease;
        }
        .calendar-day:hover:not(.empty) .event-card-expanded {
            display: block;
            transform: translateY(10px);
        }
        .event-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .event-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 60, 60, 0.4);
        }
        .event-description {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
            line-height: 1.4;
        }
        .event-link {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(255, 60, 60, 0.2);
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            border: 1px solid rgba(255, 60, 60, 0.3);
            border-radius: 6px;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        .event-link:hover {
            background: rgba(255, 60, 60, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 60, 60, 0.2);
        }

        /* Sezione informazioni pista */
        .track-info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            padding: 0 5% 40px;
            width: 100%;
            max-width: 1400px;
        }
        .info-card {
            background: rgba(25, 25, 25, 0.5);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
        }
        .info-card:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 36px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .info-card h3 {
            margin-bottom: 15px;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            font-size: 1.4rem;
        }
        .info-card p {
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
        }
        .track-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .spec-item {
            display: flex;
            flex-direction: column;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .spec-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        .spec-value {
            font-size: 1.1rem;
            font-weight: 500;
            color: #fff;
        }

        /* Mappa della pista */
        #track-map {
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
        }
        #track-map:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 36px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* Sezione meteo */
        .weather-card {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .weather-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #fff;
        }
        .weather-temp {
            font-size: 2rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 10px;
        }
        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 100%;
            margin-top: 15px;
        }
        .weather-detail {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .weather-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        .weather-value {
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
        }

        /* Sezione comunicazioni */
        .comms-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .comm-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #ff3c3c;
            transition: all 0.3s ease;
        }
        .comm-item:hover {
            transform: translateX(5px);
            background: rgba(255, 60, 60, 0.1);
        }
        .comm-date {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 5px;
        }
        .comm-title {
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
            margin-bottom: 5px;
        }
        .comm-content {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Sezione Rullini Galleria */
        .reels-section {
            padding: 40px 5%;
            width: 100%;
            max-width: 1400px;
        }
        .reel-container {
            margin-bottom: 40px;
        }
        .reel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .reel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: #fff;
        }
        .view-all-btn {
            padding: 8px 16px;
            background: rgba(255, 60, 60, 0.2);
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            border: 1px solid rgba(255, 60, 60, 0.3);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .view-all-btn:hover {
            background: rgba(255, 60, 60, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 60, 60, 0.2);
        }
        .reel-scroll {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 0;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .reel-scroll::-webkit-scrollbar {
            display: none;
        }
        .reel-item {
            flex: 0 0 auto;
            width: 280px;
            height: 180px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.4s ease;
            background: rgba(25, 25, 25, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .reel-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 60, 60, 0.3);
            border: 1px solid rgba(255, 60, 60, 0.3);
        }
        .reel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .reel-item .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            color: white;
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.8);
            opacity: 0.8;
            transition: all 0.3s ease;
        }
        .reel-item:hover .play-icon {
            opacity: 1;
            color: #ff3c3c;
        }
        .reel-item .item-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            color: white;
            font-size: 0.85rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .reel-item:hover .item-caption {
            opacity: 1;
        }
        .reel-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        .reel-nav-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .reel-nav-btn.active {
            background: #ff3c3c;
            transform: scale(1.2);
        }

        /* Lightbox per la galleria */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        .lightbox.active {
            opacity: 1;
            pointer-events: all;
        }
        .lightbox-content {
            position: relative;
            width: 80%;
            max-width: 1200px;
            max-height: 80vh;
        }
        .lightbox-content iframe {
            width: 100%;
            height: 70vh;
            border: none;
            border-radius: 8px;
        }
        .lightbox-content img {
            width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 8px;
        }
        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .lightbox-close:hover {
            color: #ff3c3c;
        }
        .lightbox-controls {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            padding: 0 20px;
        }
        .lightbox-btn {
            color: white;
            font-size: 2rem;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .lightbox-btn:hover {
            background: rgba(255, 60, 60, 0.7);
        }

        /* Responsive design */
        @media (max-width: 900px) {
            .track-info-section {
                grid-template-columns: 1fr;
            }

            .track-name {
                font-size: 2.5rem;
            }
            .track-name.smaller {
                font-size: 2rem;
            }

            .calendar-container {
                grid-template-columns: repeat(7, 1fr);
            }

            .calendar-day:hover:not(.empty) {
                transform: scale(1.4);
            }

            .event-card-expanded {
                width: 250px;
            }

            .reel-item {
                width: 220px;
                height: 150px;
            }
        }

        @media (max-width: 600px) {
            .calendar-container {
                grid-template-columns: repeat(7, 1fr);
            }

            .track-specs {
                grid-template-columns: 1fr;
            }

            .weather-details {
                grid-template-columns: 1fr;
            }

            .calendar-day:hover:not(.empty) {
                transform: scale(1.2);
            }

            .event-card-expanded {
                width: 200px;
                left: 50%;
                transform: translateX(-50%) translateY(10px);
            }

            .reel-item {
                width: 200px;
                height: 130px;
            }

            .lightbox-content {
                width: 95%;
            }
    </style>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
    <div class="logo" onclick="window.location.href='/'">
        <img src="/logoPisteKart.png" alt="Logo PisteKart" height="40">
    </div>
    <ul>
        <li><a href="#">Home</a></li>
        <li><a href="#">Tracciati</a></li>
        <li><a href="#">Info</a></li>
    </ul>
</div>

<!-- Sezione Powered by Vroom -->
<div class="powered-section">
    <div class="powered-text">POWERED BY</div>
    <img src="/vroomlogo.png" alt="Logo PisteKart" style="height:25px;">
</div>

<!-- Hero section con video e nome pista - MODIFICATO Z-INDEX -->
<div class="track-hero">
    <div class="video-background" id="video-background">
        <!-- Video YouTube in sottofondo -->
        <iframe id="main-video" src="https://www.youtube.com/embed/wXt1mUMcJaQ?autoplay=1&mute=1&loop=1&playlist=wXt1mUMcJaQ&controls=0&modestbranding=1&rel=0&enablejsapi=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
    <h1 class="track-name">PISTA MONZA</h1>

    <!-- Controlli video -->
    <div class="video-controls">
        <div class="control-btn" id="toggle-audio">
            <i class="fas fa-volume-mute"></i>
        </div>
        <div class="control-btn" id="toggle-pause">
            <i class="fas fa-pause"></i>
        </div>
    </div>
</div>

<!-- Sezione Calendario -->
<section class="calendar-section">
    <h2 class="section-title">Calendario Eventi</h2>

    <div class="calendar-header">
        <div class="calendar-nav">
            <div class="calendar-nav-btn" id="prevYear">
                <i class="fas fa-angle-double-left"></i>
            </div>
            <div class="calendar-nav-btn" id="prevMonth">
                <i class="fas fa-angle-left"></i>
            </div>
        </div>

        <div class="calendar-month-year" id="currentMonthYear">Ottobre 2023</div>

        <div class="calendar-nav">
            <div class="calendar-nav-btn" id="nextMonth">
                <i class="fas fa-angle-right"></i>
            </div>
            <div class="calendar-nav-btn" id="nextYear">
                <i class="fas fa-angle-double-right"></i>
            </div>
        </div>
    </div>

    <div class="calendar-weekdays">
        <div class="weekday">Lun</div>
        <div class="weekday">Mar</div>
        <div class="weekday">Mer</div>
        <div class="weekday">Gio</div>
        <div class="weekday">Ven</div>
        <div class="weekday">Sab</div>
        <div class="weekday">Dom</div>
    </div>

    <div class="calendar-container" id="calendarContainer">
        <!-- I giorni del calendario verranno generati dinamicamente -->
    </div>
</section>

<!-- Sezione informazioni pista -->
<section class="track-info-section">
    <!-- Descrizione e caratteristiche -->
    <div class="info-card">
        <h3>Descrizione Pista</h3>
        <p>La Pista Monza è uno dei circuiti più iconici al mondo, con una storia che risale al 1922. Conosciuta come "Il tempio della velocità", questa pista ha ospitato alcuni dei momenti più emozionanti nella storia dell'automobilismo.</p>

        <div class="track-specs">
            <div class="spec-item">
                <span class="spec-label">Lunghezza</span>
                <span class="spec-value">5.793 km</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">Curve</span>
                <span class="spec-value">11</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">Record Giro</span>
                <span class="spec-value">1:21.046</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">Capienza Kart</span>
                <span class="spec-value">30</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">Grado</span>
                <span class="spec-value">Avanzato</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">Regione</span>
                <span class="spec-value">Lombardia</span>
            </div>
        </div>
    </div>

    <!-- Mappa della pista -->
    <div class="info-card">
        <h3>Mappa del Tracciato</h3>
        <div id="track-map"></div>
    </div>

    <!-- Meteo -->
    <div class="info-card weather-card">
        <h3>Meteo Attuale</h3>
        <div class="weather-icon">
            <i class="fas fa-sun"></i>
        </div>
        <div class="weather-temp">24°C</div>

        <div class="weather-details">
            <div class="weather-detail">
                <span class="weather-label">Umidità</span>
                <span class="weather-value">45%</span>
            </div>
            <div class="weather-detail">
                <span class="weather-label">Vento</span>
                <span class="weather-value">12 km/h</span>
            </div>
            <div class="weather-detail">
                <span class="weather-label">Visibilità</span>
                <span class="weather-value">10 km</span>
            </div>
            <div class="weather-detail">
                <span class="weather-label">Pressione</span>
                <span class="weather-value">1013 hPa</span>
            </div>
        </div>
    </div>

    <!-- Comunicazioni -->
    <div class="info-card">
        <h3>Comunicazioni</h3>
        <div class="comms-list">
            <div class="comm-item">
                <div class="comm-date">15 Ottobre 2023</div>
                <div class="comm-title">Nuovo Orario Invernale</div>
                <div class="comm-content">A partire dal 1 Novembre, la pista sarà aperta dalle 9:00 alle 18:00.</div>
            </div>
            <div class="comm-item">
                <div class="comm-date">10 Ottobre 2023</div>
                <div class="comm-title">Manutenzione Straordinaria</div>
                <div class="comm-content">Il 20 Ottobre la pista sarà chiusa per interventi di manutenzione.</div>
            </div>
            <div class="comm-item">
                <div class="comm-date">5 Ottobre 2023</div>
                <div class="comm-title">Campionato Regionale</div>
                <div class="comm-content">Iscrizioni aperte per il campionato regionale di karting 2023.</div>
            </div>
        </div>
    </div>
</section>

<!-- Sezione Rullini Galleria -->
<section class="reels-section">
    <!-- Rullino Video -->
    <div class="reel-container">
        <div class="reel-header">
            <h3 class="reel-title">Video</h3>
            <a href="#" class="view-all-btn">Vedi Tutti</a>
        </div>
        <div class="reel-scroll" id="video-reel">
            <!-- Elementi video verranno aggiunti dinamicamente -->
        </div>
        <div class="reel-nav" id="video-nav">
            <!-- Pulsanti de navigazione verranno aggiunti dinamicamente -->
        </div>
    </div>

    <!-- Rullino Foto -->
    <div class="reel-container">
        <div class="reel-header">
            <h3 class="reel-title">Foto</h3>
            <a href="#" class="view-all-btn">Vedi Tutte</a>
        </div>
        <div class="reel-scroll" id="photo-reel">
            <!-- Elementi foto verranno aggiunti dinamicamente -->
        </div>
        <div class="reel-nav" id="photo-nav">
            <!-- Pulsanti di navigazione verranno aggiunti dinamicamente -->
        </div>
    </div>
</section>

<!-- Lightbox per la galleria -->
<div class="lightbox" id="lightbox">
    <div class="lightbox-content" id="lightbox-content">
        <span class="lightbox-close" id="lightbox-close">
            <i class="fas fa-times"></i>
        </span>
        <div class="lightbox-controls">
            <div class="lightbox-btn" id="lightbox-prev">
                <i class="fas fa-chevron-left"></i>
            </div>
            <div class="lightbox-btn" id="lightbox-next">
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>
    </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Inizializzazione mappa della pista
    const trackMap = L.map('track-map').setView([45.6156, 9.2812], 15);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
    }).addTo(trackMap);

    // Aggiungi tracciato della pista (semplificato)
    const trackOutline = L.polygon([
        [45.617, 9.279],
        [45.618, 9.282],
        [45.616, 9.285],
        [45.614, 9.283],
        [45.615, 9.280]
    ], {
        color: '#ff3c3c',
        weight: 3,
        fillOpacity: 0.1
    }).addTo(trackMap);

    // Centra la mappa sul tracciato
    trackMap.fitBounds(trackOutline.getBounds());

    // Dati evento di esempio (per vari mesi)
    const eventsData = {
        "2023-10-5": {
            title: "Campionato Regionale - Gara 1",
            description: "Prima gara del campionato regionale di karting. Iscrizioni aperte fino al 3 ottobre.",
            image: "https://placehold.co/600x400/ff3c3c/white?text=Campionato+Regionale"
        },
        "2023-10-12": {
            title: "Gran Premio Karting",
            description: "Evento speciale con premi per i primi classificati. Sessioni di prove libere dalle 9:00.",
            image: "/vroomlogo.png"
        },
        "2023-10-15": {
            title: "24 Ore Endurance",
            description: "Maratona di 24 ore per team di 3-6 piloti. Iscrizioni aperte!",
            image: "https://placehold.co/600x400/ff3c3c/white?text=24+Ore+Endurance"
        },
        "2023-10-19": {
            title: "Drift Challenge",
            description: "Competizione de drift con giudici internazionali e grandi premi.",
            image: "https://placehold.co/600x400/ff3c3c/white?text=Drift+Challenge"
        },
        "2023-10-22": {
            title: "Trofeo Novizi",
            description: "Evento dedicato ai principianti con lezioni e competizioni amichevoli.",
            image: "https://placehold.co/600x400/ff3c3c/white?text=Trofeo+Novizi"
        },
        "2023-10-27": {
            title: "Giornata Aperta",
            description: "Porta un amico e ottieni il 50% di sconto sul secondo kart.",
            image: "https://placehold.co/600x400/ff3c3c/white?text=Giornata+Aperta"
        },
        "2023-11-3": {
            title: "Gran Premio d'Autunno",
            description: "Evento speciale con gare per tutte le categorie.",
            image: "https://placehold.co/600x400/ff3c3c/white?text=Gran+Premio+Autunno"
        },
        "2023-11-10": {
            title: "Coppa Velocità",
            description: "Gara a cronometro per determinare il pilota più veloce.",
            image: "https://placehold.co/600x400/ff3c3c/white?text=Coppa+Velocità"
        }
    };

    // Dati per la galleria
    const galleryItems = [
        {
            type: 'video',
            src: 'https://www.youtube.com/embed/wXt1mUMcJaQ',
            thumbnail: 'https://img.youtube.com/vi/wXt1mUMcJaQ/maxresdefault.jpg',
            caption: 'Giro veloce sulla Pista Monza'
        },
        {
            type: 'video',
            src: 'https://www.youtube.com/embed/5my3gYI2B7Y',
            thumbnail: 'https://img.youtube.com/vi/5my3gYI2B7Y/maxresdefault.jpg',
            caption: 'Campionato Regionale 2023'
        },
        {
            type: 'video',
            src: 'https://www.youtube.com/embed/8ByeGsXhNnY',
            thumbnail: 'https://img.youtube.com/vi/8ByeGsXhNnY/maxresdefault.jpg',
            caption: '24 Ore Endurance - Highlights'
        },
        {
            type: 'image',
            src: 'https://images.unsplash.com/photo-1584341172166-191cbdce35f2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80',
            caption: 'Vista aerea del circuito'
        },
        {
            type: 'image',
            src: 'https://images.unsplash.com/photo-1627556704307-3135ca3f4b85?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80',
            caption: 'Box e pit stop'
        },
        {
            type: 'image',
            src: 'https://images.unsplash.com/photo-1626706555216-10c70f39aa0e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80',
            caption: 'Curva Parabolica'
        },
        {
            type: 'image',
            src: 'https://images.unsplash.com/photo-1560272564-c83b66b1ad12?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80',
            caption: 'Partenza gara'
        },
        {
            type: 'image',
            src: 'https://images.unsplash.com/photo-1593941707882-a5bba53377fe?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80',
            caption: 'Kart in pista'
        }
    ];

    // Nomi dei mesi in italiano
    const monthNames = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno",
        "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"
    ];

    // Variabili globali
    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    let mouseTimer;
    let currentGalleryIndex = 0;
    let isAudioEnabled = false;
    let isVideoPaused = false;
    let videoReelInterval;
    let photoReelInterval;

    // Funzione per generare il calendario
    function generateCalendar(month, year) {
        const calendarContainer = document.getElementById('calendarContainer');
        const monthYearElement = document.getElementById('currentMonthYear');

        // Aggiorna il titolo del mese/anno
        monthYearElement.textContent = `${monthNames[month]} ${year}`;

        // Pulisci il calendario
        calendarContainer.innerHTML = '';

        // Trova il primo giorno del mese
        const firstDay = new Date(year, month, 1).getDay();
        // Aggiusta per iniziare da lunedì (0 = lunedì, 6 = domenica)
        const firstDayIndex = (firstDay === 0) ? 6 : firstDay - 1;

        // Trova l'ultimo giorno del mese
        const lastDate = new Date(year, month + 1, 0).getDate();

        // Aggiungi giorni vuoti all'inizio
        for (let i = 0; i < firstDayIndex; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day empty';
            calendarContainer.appendChild(emptyDay);
        }

        // Aggiungi i giorni del mese
        for (let day = 1; day <= lastDate; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';

            // Formatta la data per il confronto
            const dateString = `${year}-${month + 1}-${day}`;

            // Controlla se ci sono eventi per questa data
            if (eventsData[dateString]) {
                dayElement.classList.add('has-event');

                // Aggiungi la card evento espansa
                const eventCard = document.createElement('div');
                eventCard.className = 'event-card-expanded';
                eventCard.innerHTML = `
                    <img src="${eventsData[dateString].image}" alt="${eventsData[dateString].title}" class="event-image">
                    <h3 class="event-title">${eventsData[dateString].title}</h3>
                    <p class="event-description">${eventsData[dateString].description}</p>
                    <a href="#" class="event-link">Scopri di più</a>
                `;
                dayElement.appendChild(eventCard);
            }

            dayElement.innerHTML += `
                <div class="day-number">${day}</div>
                <div class="day-events">${eventsData[dateString] ? eventsData[dateString].title : 'Nessun evento'}</div>
            `;

            calendarContainer.appendChild(dayElement);
        }
    }

    // Funzione per cambiare mese
    function changeMonth(direction) {
        currentMonth += direction;

        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        } else if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }

        generateCalendar(currentMonth, currentYear);
    }

    // Funzione per cambiare anno
    function changeYear(direction) {
        currentYear += direction;
        generateCalendar(currentMonth, currentYear);
    }

    // Animazione titolo
    function animateTitle() {
        const trackName = document.querySelector('.track-name');
        trackName.classList.add('smaller');
    }

    // Gestione scomparsa titolo quando il mouse è fermo
    function setupTitleHideOnIdle() {
        const trackName = document.querySelector('.track-name');
        const videoBackground = document.getElementById('video-background');
        let mouseX = 0;
        let mouseY = 0;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;

            // Mostra il titolo e riduci l'opacità del video quando il mouse si muove
            trackName.classList.remove('hidden');
            videoBackground.classList.remove('full-opacity');

            // Resetta il timer
            clearTimeout(mouseTimer);

            // Nascondi il titolo e aumenta l'opacità del video dopo 3 secondi di inattività
            mouseTimer = setTimeout(() => {
                trackName.classList.add('hidden');
                videoBackground.classList.add('full-opacity');
            }, 3000);
        });
    }

    // Gestione controlli video
    function setupVideoControls() {
        const videoIframe = document.getElementById('main-video');
        const toggleAudioBtn = document.getElementById('toggle-audio');
        const togglePauseBtn = document.getElementById('toggle-pause');

        // Abilita/disabilita audio
        toggleAudioBtn.addEventListener('click', () => {
            isAudioEnabled = !isAudioEnabled;
            const newSrc = isAudioEnabled ?
                videoIframe.src.replace('mute=1', 'mute=0') :
                videoIframe.src.replace('mute=0', 'mute=1');

            videoIframe.src = newSrc;

            // Cambia icona
            toggleAudioBtn.innerHTML = isAudioEnabled ?
                '<i class="fas fa-volume-up"></i>' :
                '<i class="fas fa-volume-mute"></i>';
        });

        // Pausa/riproduci video
        togglePauseBtn.addEventListener('click', () => {
            isVideoPaused = !isVideoPaused;

            if (isVideoPaused) {
                // Metti in pausa il video
                videoIframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                togglePauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                // Riproduci il video
                videoIframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                togglePauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
        });
    }

    // Inizializzazione rullini galleria
    function initReels() {
        const videoReel = document.getElementById('video-reel');
        const photoReel = document.getElementById('photo-reel');
        const videoNav = document.getElementById('video-nav');
        const photoNav = document.getElementById('photo-nav');

        // Separa video e immagini
        const videoItems = galleryItems.filter(item => item.type === 'video');
        const photoItems = galleryItems.filter(item => item.type === 'image');

        // Aggiungi elementi video al rullino
        videoItems.forEach((item, index) => {
            const reelItem = document.createElement('div');
            reelItem.className = 'reel-item';
            reelItem.dataset.index = index;
            reelItem.innerHTML = `
                <img src="${item.thumbnail}" alt="${item.caption}">
                <div class="play-icon"><i class="fas fa-play"></i></div>
                <div class="item-caption">${item.caption}</div>
            `;
            reelItem.addEventListener('click', () => openLightbox(index, 'video'));
            videoReel.appendChild(reelItem);

            // Aggiungi punto di navigazione
            const navBtn = document.createElement('div');
            navBtn.className = 'reel-nav-btn';
            if (index === 0) navBtn.classList.add('active');
            navBtn.dataset.index = index;
            navBtn.addEventListener('click', () => scrollToReelItem(videoReel, index));
            videoNav.appendChild(navBtn);
        });

        // Aggiungi elementi foto al rullino
        photoItems.forEach((item, index) => {
            const reelItem = document.createElement('div');
            reelItem.className = 'reel-item';
            reelItem.dataset.index = index;
            reelItem.innerHTML = `
                <img src="${item.src}" alt="${item.caption}">
                <div class="item-caption">${item.caption}</div>
            `;
            reelItem.addEventListener('click', () => openLightbox(index, 'photo'));
            photoReel.appendChild(reelItem);

            // Aggiungi punto de navigazione
            const navBtn = document.createElement('div');
            navBtn.className = 'reel-nav-btn';
            if (index === 0) navBtn.classList.add('active');
            navBtn.dataset.index = index;
            navBtn.addEventListener('click', () => scrollToReelItem(photoReel, index));
            photoNav.appendChild(navBtn);
        });

        // Auto-scroll per i rullini
        startReelAutoScroll(videoReel, videoNav, videoItems.length);
        startReelAutoScroll(photoReel, photoNav, photoItems.length);
    }

    // Funzione per lo scroll automatico dei rullini
    function startReelAutoScroll(reel, nav, itemCount) {
        let currentIndex = 0;

        setInterval(() => {
            currentIndex = (currentIndex + 1) % itemCount;
            scrollToReelItem(reel, currentIndex);

            // Aggiorna navigazione
            const navButtons = nav.querySelectorAll('.reel-nav-btn');
            navButtons.forEach(btn => btn.classList.remove('active'));
            navButtons[currentIndex].classList.add('active');
        }, 4000); // Cambia elemento ogni 4 secondi
    }

    // Funzione per scorrere a un elemento specifico del rullino
    function scrollToReelItem(reel, index) {
        const items = reel.querySelectorAll('.reel-item');
        if (items[index]) {
            //items[index].scrollIntoView({
            //  behavior: 'smooth',
            //inline: 'center'
            //});
        }
    }

    // Lightbox galleria
    function openLightbox(index, type) {
        const lightbox = document.getElementById('lightbox');
        const lightboxContent = document.getElementById('lightbox-content');

        // Trova l'elemento corretto in base al tipo
        let item;
        if (type === 'video') {
            const videoItems = galleryItems.filter(item => item.type === 'video');
            item = videoItems[index];
            currentGalleryIndex = galleryItems.findIndex(i => i.src === item.src);
        } else {
            const photoItems = galleryItems.filter(item => item.type === 'image');
            item = photoItems[index];
            currentGalleryIndex = galleryItems.findIndex(i => i.src === item.src);
        }

        if (item.type === 'video') {
            lightboxContent.innerHTML = `
                <span class="lightbox-close" id="lightbox-close">
                    <i class="fas fa-times"></i>
                </span>
                <div class="lightbox-controls">
                    <div class="lightbox-btn" id="lightbox-prev">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                    <div class="lightbox-btn" id="lightbox-next">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <iframe src="${item.src}?autoplay=1&rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            `;
        } else {
            lightboxContent.innerHTML = `
                <span class="lightbox-close" id="lightbox-close">
                    <i class="fas fa-times"></i>
                </span>
                <div class="lightbox-controls">
                    <div class="lightbox-btn" id="lightbox-prev">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                    <div class="lightbox-btn" id="lightbox-next">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <img src="${item.src}" alt="${item.caption}">
            `;
        }

        lightbox.classList.add('active');

        // Aggiungi event listeners per i controlli del lightbox
        document.getElementById('lightbox-close').addEventListener('click', closeLightbox);
        document.getElementById('lightbox-prev').addEventListener('click', () => navigateLightbox(-1));
        document.getElementById('lightbox-next').addEventListener('click', () => navigateLightbox(1));
    }

    function closeLightbox() {
        const lightbox = document.getElementById('lightbox');
        lightbox.classList.remove('active');
    }

    function navigateLightbox(direction) {
        let newIndex = currentGalleryIndex + direction;

        if (newIndex < 0) {
            newIndex = galleryItems.length - 1;
        } else if (newIndex >= galleryItems.length) {
            newIndex = 0;
        }

        openLightbox(newIndex, galleryItems[newIndex].type);
    }

    // Inizializzazione
    document.addEventListener('DOMContentLoaded', () => {
        generateCalendar(currentMonth, currentYear);

        // Aggiungi event listeners per la navigazione
        document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
        document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
        document.getElementById('prevYear').addEventListener('click', () => changeYear(-1));
        document.getElementById('nextYear').addEventListener('click', () => changeYear(1));

        // Animazione del titolo dopo il caricamento
        setTimeout(animateTitle, 1000);

        // Animazione del titolo allo scroll
        window.addEventListener('scroll', () => {
            const trackName = document.querySelector('.track-name');
            if (window.scrollY > 50 && !trackName.classList.contains('smaller')) {
                trackName.classList.add('smaller');
            } else if (window.scrollY <= 50 && trackName.classList.contains('smaller')) {
                trackName.classList.remove('smaller');
            }
        });

        // Configura il comportamento di scomparsa del titolo
        setupTitleHideOnIdle();

        // Configura i controlli video
        setupVideoControls();

        // Inizializza i rullini
        initReels();

        // Chiudi lightbox con ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeLightbox();
            } else if (e.key === 'ArrowLeft') {
                navigateLightbox(-1);
            } else if (e.key === 'ArrowRight') {
                navigateLightbox(1);
            }
        });
    });
</script>
</body>
</html>